// temp file for mobile route
import { NextResponse } from 'next/server';

const API_KEY = 'pk_live_JswWSUmBs6fvt1rRpayAULTNQUfxZZ3I';
const API_URL = 'https://fatafatsewa.com/api/v1/products';

export async function GET() {
  try {
    const response = await fetch(`${API_URL}?category=mobile`, {
      headers: {
        'Authorization': `Bearer ${API_KEY}`,
        'Content-Type': 'application/json',
      },
      next: {
        revalidate: 3600 // Revalidate every hour
      }
    });

    if (!response.ok) {
      throw new Error(`HTTP error! status: ${response.status}`);
    }

    const data = await response.json();

    // Transform and validate the data
    const formattedData = data.map(item => ({
      id: item.id,
      name: item.name || 'Unknown Product',
      description: item.description || '',
      price: parseFloat(item.price) || 0,
      oldPrice: item.old_price ? parseFloat(item.old_price) : null,
      image: item.image || item.images?.[0] || '/assets/placeholder.jpg',
      tag: item.tag || (item.discount ? `${item.discount}% Off` : ''),
      storage: item.storage || '',
      color: item.color || '',
      specs: {
        display: item.display || '',
        camera: item.camera || '',
        processor: item.processor || '',
        battery: item.battery || '',
        os: item.os || '',
      }
    }));

    return NextResponse.json(formattedData);
  } catch (error) {
    console.error('Error fetching mobile products:', error);
    return NextResponse.json(
      { error: 'Failed to fetch mobile products' },
      { status: 500 }
    );
  }
}
